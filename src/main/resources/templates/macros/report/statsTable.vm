#macro(includeStatsTable, $table_key, $parallel, $items, $report_summary)

<table id="tablesorter" class="stats-table table-hover">
    #includeReportHeader($table_key, $parallel)

    <tbody>
        #foreach($item in $items)
        <tr>
            <td class="tagname">
                <a href="$item.getReportFileName()">$item.getName()</a>
            </td>
            #if ($parallel)
                <td>$item.getDeviceName()</td>
            #end

            <td #if ($item.getPassedSteps() > 0)     class="passed"    #end>$item.getPassedSteps()</td>
            <td #if ($item.getFailedSteps() > 0)     class="failed"    #end>$item.getFailedSteps()</td>
            <td #if ($item.getSkippedSteps() > 0)    class="skipped"   #end>$item.getSkippedSteps()</td>
            <td #if ($item.getPendingSteps() > 0)    class="pending"   #end>$item.getPendingSteps()</td>
            <td #if ($item.getUndefinedSteps() > 0)  class="undefined" #end>$item.getUndefinedSteps()</td>
            <td class="total">$item.getSteps()</td>

            <td #if ($item.getPassedScenarios() > 0) class="passed"    #end>$item.getPassedScenarios()</td>
            <td #if ($item.getFailedScenarios() > 0) class="failed"    #end>
                #if ($item.getFailedSteps() > 0)
                    <div class="dropup">
                        <button class="btn btn-danger dropdown-toggle" type="button" id="failed-cause-dropdown"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            $item.getFailedScenarios()
                        </button>
                        <div class="dropdown-menu dropdown-menu-right"
                             aria-labelledby="failed-cause-dropdown"
                             style="max-height: 25vh; overflow-x: hidden;
                             min-width: 20vw; max-width: 40vw;
                             background-color: #D3D3D3"
                        >
                            #set ($failedCauseList = $item.getFailedCause())
                            #foreach($failedCauseData in $failedCauseList)
                                #set ($scenarioName = $failedCauseData[0])
                                #set ($stepName = $failedCauseData[1])
                                #set ($stepId = $failedCauseData[2])
                                #set ($errorMessage = $failedCauseData[3])
                                <div class="bs-callout bs-callout-danger" style="background-color: white">
                                    <h4>$scenarioName</h4>
                                    <strong>
                                        <a class="step-name" href="$item.getReportFileName()#$stepId">$stepName</a>
                                    </strong>
                                    <br>
                                    <samp>$errorMessage</samp>
                                </div>
                            #end
                        </div>
                    </div>
                #else
                    $item.getFailedScenarios()
                #end
            </td>
            <td class="total">$item.getScenarios()</td>

            <td class="duration" data-value="$item.getDuration()">$item.getFormattedDuration()</td>
            <td class="$item.getStatus().getRawName()">$item.getStatus().getLabel()</td>
        </tr>
        #end
    </tbody>

  <tfoot class="total">
    <tr>
        <td>$items.size()</td>
        #if ($parallel)
            <td>-</td>
        #end
        <td>$report_summary.getPassedSteps()</td>
        <td>$report_summary.getFailedSteps()</td>
        <td>$report_summary.getSkippedSteps()</td>
        <td>$report_summary.getPendingSteps()</td>
        <td>$report_summary.getUndefinedSteps()</td>
        <td>$report_summary.getSteps()</td>

        <td>$report_summary.getPassedScenarios()</td>
        <td>$report_summary.getFailedScenarios()</td>
        <td>$report_summary.getScenarios()</td>

      <td class="duration">$report_summary.getFormattedDuration()</td>
      <td></td>
    </tr>
    <tr>
        <td></td>
        #if ($parallel)
            <td>-</td>
        #end
        <td>$util.formatAsPercentage($report_summary.getPassedSteps(), $report_summary.getSteps())</td>
        <td>$util.formatAsPercentage($report_summary.getFailedSteps(), $report_summary.getSteps())</td>
        <td>$util.formatAsPercentage($report_summary.getSkippedSteps(), $report_summary.getSteps())</td>
        <td>$util.formatAsPercentage($report_summary.getPendingSteps(), $report_summary.getSteps())</td>
        <td>$util.formatAsPercentage($report_summary.getUndefinedSteps(), $report_summary.getSteps())</td>
        <td></td>
        <td>$util.formatAsPercentage($report_summary.getPassedScenarios(), $report_summary.getScenarios())</td>
        <td>$util.formatAsPercentage($report_summary.getFailedScenarios(), $report_summary.getScenarios())</td>
        <td></td>
        <td></td>
        <td>$util.formatAsPercentage($report_summary.getPassedFeatures(), $report_summary.getFeatures())</td>
    </tr>
  </tfoot>
</table>

#end
